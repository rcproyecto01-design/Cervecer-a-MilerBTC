<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MilerBTC Cervecer√≠a Premium - Las Mejores Cervezas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
        }

        header {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ffa500;
        }

        .cart-icon {
            position: relative;
            font-size: 28px;
            cursor: pointer;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .hero {
            padding: 150px 20px 80px;
            text-align: center;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><rect fill="%23ffa500" opacity="0.1" width="1200" height="600"/></svg>');
            background-size: cover;
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ffa500;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero p {
            font-size: 20px;
            margin-bottom: 30px;
        }

        .payment-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255, 165, 0, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid #ffa500;
            font-weight: bold;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(255, 165, 0, 0.3);
            border-color: #ffa500;
        }

        .product-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .product-card h3 {
            color: #ffa500;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .price {
            font-size: 32px;
            font-weight: bold;
            margin: 20px 0;
            color: #fff;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .quantity-btn {
            background: #ffa500;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .quantity-btn:hover {
            background: #ff8c00;
        }

        .quantity-display {
            font-size: 24px;
            font-weight: bold;
            min-width: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);
            color: #fff;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 165, 0, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 30px;
            right: 30px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 35px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            cursor: pointer;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            overflow-y: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            margin: 50px auto;
            padding: 40px;
            border: 2px solid #ffa500;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close {
            color: #ffa500;
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #ff8c00;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ffa500;
            font-weight: bold;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffa500;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff8c00;
            background: rgba(255, 255, 255, 0.15);
        }

        .cart-item {
            background: rgba(255, 165, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shipping-cost {
            background: rgba(255, 165, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .total-cost {
            font-size: 28px;
            font-weight: bold;
            color: #ffa500;
            text-align: center;
            margin: 20px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(255, 165, 0, 0.3);
            border-top: 4px solid #ffa500;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .payment-option {
            background: rgba(255, 165, 0, 0.1);
            padding: 15px;
            border: 2px solid #ffa500;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-option:hover {
            background: rgba(255, 165, 0, 0.2);
            transform: scale(1.05);
        }

        .payment-option.selected {
            background: rgba(255, 165, 0, 0.3);
            border-color: #ff8c00;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        footer {
            background: rgba(0, 0, 0, 0.8);
            text-align: center;
            padding: 30px;
            margin-top: 60px;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 32px;
            }
            
            .products {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 20px auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">üç∫ Cervecer√≠a Premium</div>
            <div class="cart-icon" onclick="openCart()">
                üõí
                <span class="cart-count" id="cartCount">0</span>
            </div>
        </nav>
    </header>

    <section class="hero">
        <h1>Las Mejores Cervezas Artesanales</h1>
        <p>Calidad premium directo a tu puerta</p>
        <div class="payment-badges">
            <span class="badge">üí≥ Mercado Pago</span>
            <span class="badge">‚Çø Bitcoin</span>
            <span class="badge">üöö Env√≠o con Zipnova</span>
        </div>
    </section>

    <div class="container">
        <h2 style="text-align: center; font-size: 36px; margin-bottom: 20px; color: #ffa500;">Nuestros Productos</h2>
        
        <div class="products" id="productsContainer"></div>
    </div>

    <!-- Modal Carrito -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCart()">&times;</span>
            <h2 style="color: #ffa500; margin-bottom: 30px;">Tu Pedido</h2>
            
            <div id="cartItems"></div>
            
            <div id="checkoutForm" style="display: none;">
                <h3 style="color: #ffa500; margin: 30px 0 20px;">Datos de Env√≠o</h3>
                
                <div class="form-group">
                    <label>Nombre Completo *</label>
                    <input type="text" id="customerName" required>
                </div>

                <div class="form-group">
                    <label>Tel√©fono *</label>
                    <input type="tel" id="customerPhone" required>
                </div>

                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="customerEmail" required>
                </div>

                <div class="form-group">
                    <label>Provincia *</label>
                    <select id="provincia" required>
                        <option value="">Selecciona una provincia</option>
                        <option value="Buenos Aires">Buenos Aires</option>
                        <option value="CABA">CABA</option>
                        <option value="C√≥rdoba">C√≥rdoba</option>
                        <option value="Santa Fe">Santa Fe</option>
                        <option value="Mendoza">Mendoza</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ciudad *</label>
                    <input type="text" id="ciudad" required>
                </div>

                <div class="form-group">
                    <label>C√≥digo Postal *</label>
                    <input type="text" id="codigoPostal" required>
                </div>

                <div class="form-group">
                    <label>Calle *</label>
                    <input type="text" id="calle" required>
                </div>

                <div class="form-group">
                    <label>N√∫mero *</label>
                    <input type="text" id="numero" required>
                </div>

                <div class="form-group">
                    <label>Piso/Depto (Opcional)</label>
                    <input type="text" id="piso">
                </div>

                <button class="btn" onclick="calculateShipping()" style="width: 100%; margin-top: 20px;">
                    Calcular Costo de Env√≠o
                </button>

                <div class="loading" id="loadingShipping">
                    <div class="spinner"></div>
                    <p>Calculando costo de env√≠o...</p>
                </div>

                <div class="shipping-cost" id="shippingCost" style="display: none;">
                    <h3 style="color: #ffa500;">Costo de Env√≠o: $<span id="shippingPrice">0</span></h3>
                    <p>Tiempo estimado: <span id="estimatedTime">-</span></p>
                </div>

                <div class="total-cost" id="totalCost" style="display: none;">
                    Total Final: $<span id="totalPrice">0</span>
                </div>

                <div id="paymentSection" style="display: none;">
                    <h3 style="color: #ffa500; margin: 30px 0 20px;">M√©todo de Pago</h3>
                    
                    <div class="payment-options">
                        <div class="payment-option" onclick="selectPayment('mercadopago')">
                            <div style="font-size: 30px;">üí≥</div>
                            <div>Mercado Pago</div>
                        </div>
                        <div class="payment-option" onclick="selectPayment('bitcoin')">
                            <div style="font-size: 30px;">‚Çø</div>
                            <div>Bitcoin</div>
                        </div>
                        <div class="payment-option" onclick="selectPayment('transferencia')">
                            <div style="font-size: 30px;">üè¶</div>
                            <div>Transferencia</div>
                        </div>
                    </div>

                    <button class="btn" id="finalizeBtn" onclick="finalizeOrder()" style="width: 100%; margin-top: 30px;" disabled>
                        Finalizar Pedido
                    </button>
                </div>

                <div class="success-message" id="successMessage">
                    <h3 style="color: #4CAF50;">¬°Pedido Creado Exitosamente! üéâ</h3>
                    <p id="successText"></p>
                </div>

                <div class="error-message" id="errorMessage">
                    <h3 style="color: #f44336;">Error</h3>
                    <p id="errorText"></p>
                </div>
            </div>

            <div id="emptyCart">
                <p style="text-align: center; padding: 40px;">Tu carrito est√° vac√≠o</p>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Cervecer√≠a Premium. Todos los derechos reservados.</p>
        <p style="margin-top: 10px;">Beb√© con moderaci√≥n. Prohibida su venta a menores de 18 a√±os.</p>
    </footer>

    <a class="whatsapp-float" onclick="abrirWhatsApp()">
        <span>üí¨</span>
    </a>

    <script>
        const CONFIG = {
            numeroWhatsApp: '549234415501539',
            apiEndpoint: '/.netlify/functions/zipnova'
        };

        const products = [
            { id: 1, name: 'Cerveza Rubia', price: 800, icon: 'üç∫', weight: 0.5 },
            { id: 2, name: 'Cerveza Negra', price: 900, icon: 'üçª', weight: 0.5 },
            { id: 3, name: 'IPA Artesanal', price: 1100, icon: 'üç∫', weight: 0.5 },
            { id: 4, name: 'Pack x6 Mixto', price: 4500, icon: 'üçª', weight: 3 }
        ];

        let cart = [];
        let selectedPayment = '';
        let shippingData = null;

        function renderProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-icon">${product.icon}</div>
                    <h3>${product.name}</h3>
                    <div class="price">$${product.price}</div>
                    <div class="quantity-selector">
                        <button class="quantity-btn" onclick="updateQuantity(${product.id}, -1)">-</button>
                        <span class="quantity-display" id="qty-${product.id}">0</span>
                        <button class="quantity-btn" onclick="updateQuantity(${product.id}, 1)">+</button>
                    </div>
                    <button class="btn" onclick="addToCart(${product.id})">Agregar al Carrito</button>
                </div>
            `).join('');
        }

        function updateQuantity(productId, change) {
            const qtyElement = document.getElementById(`qty-${productId}`);
            let currentQty = parseInt(qtyElement.textContent);
            currentQty = Math.max(0, currentQty + change);
            qtyElement.textContent = currentQty;
        }

        function addToCart(productId) {
            const qtyElement = document.getElementById(`qty-${productId}`);
            const qty = parseInt(qtyElement.textContent);
            
            if (qty === 0) {
                alert('Por favor selecciona una cantidad');
                return;
            }

            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += qty;
            } else {
                cart.push({ ...product, quantity: qty });
            }

            qtyElement.textContent = '0';
            updateCartCount();
            alert(`${product.name} agregado al carrito`);
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        function openCart() {
            if (cart.length === 0) {
                document.getElementById('emptyCart').style.display = 'block';
                document.getElementById('cartItems').style.display = 'none';
                document.getElementById('checkoutForm').style.display = 'none';
            } else {
                document.getElementById('emptyCart').style.display = 'none';
                document.getElementById('cartItems').style.display = 'block';
                document.getElementById('checkoutForm').style.display = 'block';
                renderCart();
            }
            document.getElementById('cartModal').style.display = 'block';
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        function renderCart() {
            const cartItemsDiv = document.getElementById('cartItems');
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            cartItemsDiv.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div>
                        <strong>${item.name}</strong><br>
                        Cantidad: ${item.quantity} x $${item.price}
                    </div>
                    <div style="text-align: right;">
                        <strong>$${item.price * item.quantity}</strong><br>
                        <button onclick="removeFromCart(${item.id})" style="color: #ff4444; background: none; border: none; cursor: pointer;">Eliminar</button>
                    </div>
                </div>
            `).join('') + `
                <div style="text-align: right; font-size: 20px; font-weight: bold; margin-top: 20px; color: #ffa500;">
                    Subtotal: $${subtotal}
                </div>
            `;
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartCount();
            if (cart.length === 0) {
                closeCart();
            } else {
                renderCart();
            }
        }

        async function calculateShipping() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const email = document.getElementById('customerEmail').value;
            const provincia = document.getElementById('provincia').value;
            const ciudad = document.getElementById('ciudad').value;
            const cp = document.getElementById('codigoPostal').value;
            const calle = document.getElementById('calle').value;
            const numero = document.getElementById('numero').value;

            if (!name || !phone || !email || !provincia || !ciudad || !cp || !calle || !numero) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }

            document.getElementById('loadingShipping').style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';

            try {
                const totalWeight = cart.reduce((sum, item) => sum + (item.weight * item.quantity), 0);
                
                const response = await fetch(CONFIG.apiEndpoint + '/quote', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination: {
                            provincia,
                            ciudad,
                            codigo_postal: cp,
                            calle,
                            numero,
                            piso: document.getElementById('piso').value
                        },
                        weight: totalWeight
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    shippingData = data.data;
                    document.getElementById('shippingPrice').textContent = data.data.price;
                    document.getElementById('estimatedTime').textContent = data.data.estimatedTime || '2-5 d√≠as';
                    document.getElementById('shippingCost').style.display = 'block';
                    
                    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    const total = subtotal + data.data.price;
                    document.getElementById('totalPrice').textContent = total;
                    document.getElementById('totalCost').style.display = 'block';
                    document.getElementById('paymentSection').style.display = 'block';
                } else {
                    throw new Error(data.message || 'Error al calcular env√≠o');
                }
            } catch (error) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorText').textContent = error.message;
            } finally {
                document.getElementById('loadingShipping').style.display = 'none';
            }
        }

        function selectPayment(method) {
            selectedPayment = method;
            document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('selected'));
            event.target.closest('.payment-option').classList.add('selected');
            document.getElementById('finalizeBtn').disabled = false;
        }

        async function finalizeOrder() {
            if (!selectedPayment) {
                alert('Por favor selecciona un m√©todo de pago');
                return;
            }

            document.getElementById('finalizeBtn').disabled = true;
            document.getElementById('errorMessage').style.display = 'none';

            try {
                const orderData = {
                    customer: {
                        name: document.getElementById('customerName').value,
                        phone: document.getElementById('customerPhone').value,
                        email: document.getElementById('customerEmail').value
                    },
                    address: {
                        provincia: document.getElementById('provincia').value,
                        ciudad: document.getElementById('ciudad').value,
                        codigo_postal: document.getElementById('codigoPostal').value,
                        calle: document.getElementById('calle').value,
                        numero: document.getElementById('numero').value,
                        piso: document.getElementById('piso').value
                    },
                    items: cart,
                    payment: selectedPayment,
                    shippingCost: parseFloat(document.getElementById('shippingPrice').textContent)
                };

                const response = await fetch(CONFIG.apiEndpoint + '/create-shipment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('successText').innerHTML = `
                        <strong>N√∫mero de tracking:</strong> ${data.trackingNumber}<br>
                        <strong>Total:</strong> $${document.getElementById('totalPrice').textContent}<br><br>
                        Te contactaremos por WhatsApp para coordinar el pago.
                    `;
                    
                    cart = [];
                    updateCartCount();
                    
                    setTimeout(() => {
                        closeCart();
                    }, 5000);
                } else {
                    throw new Error(data.message || 'Error al crear el pedido');
                }
            } catch (error) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorText').textContent = error.message;
                document.getElementById('finalizeBtn').disabled = false;
            }
        }

        function abrirWhatsApp() {
            const mensaje = '¬°Hola! Me gustar√≠a consultar sobre sus cervezas.';
            const url = `https://wa.me/${CONFIG.numeroWhatsApp}?text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('cartModal')) {
                closeCart();
            }
        }

        renderProducts();
    </script>
</body>
</html>
